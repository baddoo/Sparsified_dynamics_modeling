function [X,Y,K] = vortex_setup(nc,nvc,spread,dim)

if dim ==2

%% Set up point vortices in clusters
lp = -5;up = 5; nrange = 100;
% Generate centers of clusters
Xcent = randi([lp*nrange up*nrange],nc,1)/nrange;
Ycent = randi([lp*nrange up*nrange],nc,1)/nrange;

Generate vortices around centers
Xvorts(:,i)=Xcent(i)+spread*randn(nvc,1);
Yvorts(:,i)=Ycent(i)+spread*randn(nvc,1);
    

% Reshape vortex positions into a long vector 
X = reshape(Xvorts,nc*nvc,[]);
Y = reshape(Yvorts,nc*nvc,[]);

%Plot vortex centers
plot(Xcent,Ycent,'ko','MarkerFaceColor','r');hold on;
plot(X,Y,'b.');
axis equal;
hold off

elseif dim==3

% Should change this so that the points are randomly
% distributed in a circle around the center, on the sphere.
Xvorts =Xcent + asin(spread*(-1+2*rand(nvc,nc)));
Yvorts=Ycent + spread*pi/2*(1-2*rand(nvc,nc));


% Generate circulations
K = randfixedsum(nvc*nc,1,0,-.1,.1); % On the sphere the circulations must sum to zero

% Reshape vortex positions into a long vector 
X = reshape(Xvorts,nc*nvc,[]);
Y = reshape(Yvorts,nc*nvc,[]);

% Plot initial configuration on the sphere

MFC = 'MarkerFaceColor'; CL = 'Color';

[x, y, z] = sphere(128);
h = surfl(x, y, z,'light'); 
hold on
colormap gray
shading interp
fac = 1.01;
[x1,y1,z1] = sph2cart(Ycent,Xcent,fac);
[xv,yv,zv] = sph2cart(Yvorts,Xvorts,fac);


plot3(x1,y1,z1,'ko',MFC,'g')
p = (K>0);
scatter3(xv(p),yv(p),zv(p),5*abs(log(K(p))),'ro',MFC,'r')
scatter3(xv(~p),yv(~p),zv(~p),5*abs(log(-K(~p))),'bo',MFC,'b')

hold off
axis equal
axis off
lighting gouraud

axis vis3d

end

end
